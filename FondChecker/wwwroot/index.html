<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fond Management</title>
    <!-- Link to CSS file -->
    <link rel="stylesheet" href="css/style.css"> <!-- Corrected path -->
</head>
<body>
    <h1>Fond Management</h1>

    <!-- Form to Add/Edit Fond -->
    <form id="fondForm">
        <label for="naziv">Naziv:</label>
        <input type="text" id="naziv" placeholder="Naziv" required>
        
        <label for="iznosSredstava">Iznos Sredstava:</label>
        <input type="number" id="iznosSredstava" placeholder="Iznos Sredstava" required>
        
        <label for="brojProjekata">Broj Projekata:</label>
        <input type="number" id="brojProjekata" placeholder="Broj Projekata" required>
        
        <label for="uProvedbiDo">U Provedbi Do:</label>
        <input type="date" id="uProvedbiDo" placeholder="U Provedbi Do" required>
        
        <!-- Hidden field for Sifra (ID) -->
        <input type="hidden" id="fondId">
        
        <button type="submit">Save</button>
        <button type="button" id="cancelFondEdit">Cancel</button>
    </form>

    <!-- Table to Display List of Fonds -->
    <table>
        <thead>
            <tr>
                <th>Naziv</th>
                <th>Iznos Sredstava</th>
                <th>Broj Projekata</th>
                <th>U Provedbi Do</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="fondsTableBody">
            <!-- JavaScript will dynamically add rows here -->
        </tbody>$(document).ready(function () {
            // Load the list of Fonds on page load
            loadFondsList();
        
            // Event listener for adding or updating a Fond
            $('#fondForm').on('submit', saveFond);
        
            // Event listener to clear the form on cancel
            $('#cancelFondEdit').on('click', function () {
                $('#fondForm')[0].reset();
                $('#fondId').val(''); // Clear hidden ID field
            });
        
            // Event listeners for editing and deleting a Fond
            $(document).on('click', '.edit-fond', function () {
                const id = $(this).data('id');
                loadFond(id); // Load the Fond details for editing
            });
        
            $(document).on('click', '.delete-fond', function () {
                const id = $(this).data('id');
                deleteFond(id); // Delete the Fond
            });
        });
        
        // Load the list of Fonds and display in table
        function loadFondsList() {
            $.getJSON('/api/v1/Fond', function (fonds) {
                const fondsTableBody = $('#fondsTableBody');
                fondsTableBody.empty();
                $.each(fonds, function (index, fond) {
                    const row = $('<tr></tr>');
                    row.append(`<td>${fond.naziv}</td>`);
                    row.append(`<td>${fond.iznosSredstava}</td>`);
                    row.append(`<td>${fond.brojProjekata}</td>`);
                    row.append(`<td>${fond.uProvedbiDo ? fond.uProvedbiDo.split('T')[0] : 'N/A'}</td>`);
                    row.append(`<td>
                        <button class="edit-fond" data-id="${fond.sifra}">Edit</button> |
                        <button class="delete-fond" data-id="${fond.sifra}">Delete</button>
                    </td>`);
                    fondsTableBody.append(row);
                });
            }).fail(function () {
                alert('Error loading fonds.');
            });
        }
        
        // Load a specific Fond by ID to edit
        function loadFond(id) {
            $.getJSON(`/api/v1/Fond/${id}`, function (fond) {
                $('#fondId').val(fond.sifra);
                $('#naziv').val(fond.naziv);
                $('#iznosSredstava').val(fond.iznosSredstava);
                $('#brojProjekata').val(fond.brojProjekata);
                $('#uProvedbiDo').val(fond.uProvedbiDo ? fond.uProvedbiDo.split('T')[0] : '');
            }).fail(function () {
                alert('Error loading fond details.');
            });
        }
        
        // Save a new or updated Fond
        function saveFond(event) {
            event.preventDefault();
            const id = $('#fondId').val();
            const isUpdate = !!id;
        
            const fond = {
                naziv: $('#naziv').val(),
                iznosSredstava: $('#iznosSredstava').val(),
                brojProjekata: $('#brojProjekata').val(),
                uProvedbiDo: $('#uProvedbiDo').val()
            };
        
            if (isUpdate) {
                fond.sifra = id;
            }
        
            const requestType = isUpdate ? 'PUT' : 'POST';
            const requestUrl = '/api/v1/Fond';
        
            $.ajax({
                url: requestUrl,
                type: requestType,
                contentType: 'application/json',
                data: JSON.stringify(fond),
                success: function () {
                    alert('Fond saved successfully.');
                    $('#fondForm')[0].reset();
                    $('#fondId').val('');
                    loadFondsList(); // Reload the list of Fonds
                },
                error: function () {
                    alert('Error saving fond.');
                }
            });
        }
        
        // Delete a Fond by ID
        function deleteFond(id) {
            $.ajax({
                url: `/api/v1/Fond/${id}`,
                type: 'DELETE',
                success: function () {
                    alert('Fond deleted successfully.');
                    loadFondsList(); // Reload the list of Fonds
                },
                error: function () {
                    alert('Error deleting fond.');
                }
            });
        }
        
    </table>

    <!-- Link to JavaScript file (place before closing body tag) -->
    <script src="js/fondManager.js"></script> <!-- Corrected path -->
</body>
</html>
